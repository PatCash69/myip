<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Min IP och Platsinfo</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-sA+e2HTiG4bESdbLBbB8PJyEjlcxyF3qgU9L3xXwUyk="
    crossorigin=""
  />
  <style>
    #map {
      height: 400px;
    }
  </style>
</head>
<body class="bg-gray-50 text-gray-800">

  <div class="max-w-3xl mx-auto px-4 py-10">
    <h1 class="text-3xl font-bold text-center mb-6">üåê Din IP & Platsinfo</h1>

    <div class="bg-white shadow-md rounded-xl p-6 space-y-4">
      <div><span class="font-semibold">IP-adress:</span> <span id="ip">Laddar...</span></div>
      <div><span class="font-semibold">Stad:</span> <span id="city">-</span></div>
      <div><span class="font-semibold">Land:</span> <span id="country">-</span></div>
      <div><span class="font-semibold">Tidszon:</span> <span id="timezone">-</span></div>
      <div><span class="font-semibold">Webbl√§sare:</span> <span id="ua">-</span></div>
      <div><span class="font-semibold">V√§der:</span> <span id="weather">H√§mtar...</span></div>
    </div>

    <div class="mt-6 bg-white shadow-md rounded-xl overflow-hidden">
      <div id="map"></div>
    </div>
  </div>

  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-o9N1jv4JrjGTTcOvRph0Wh5re+K53YgnP5CF3YDeY+E="
    crossorigin=""
  ></script>

  <script>
    document.getElementById('ua').textContent = navigator.userAgent;

    fetch('https://ipapi.co/json/')
      .then(res => res.json())
      .then(data => {
        const { ip, city, country_name, timezone, latitude, longitude } = data;

        document.getElementById('ip').textContent = ip;
        document.getElementById('city').textContent = city;
        document.getElementById('country').textContent = country_name;
        document.getElementById('timezone').textContent = timezone;

        const map = L.map('map').setView([latitude, longitude], 10);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          attribution: '&copy; OpenStreetMap-bidragsgivare'
        }).addTo(map);

        L.marker([latitude, longitude])
          .addTo(map)
          .bindPopup(`Du √§r h√§r: ${city}, ${country_name}`)
          .openPopup();

        fetch(`https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current_weather=true`)
          .then(res => res.json())
          .then(weatherData => {
            const weather = weatherData.current_weather;
            const temp = weather.temperature;
            const weatherCode = weather.weathercode;
            const iconMap = {
              0: '‚òÄÔ∏è Klart',
              1: 'üå§Ô∏è Mest klart',
              2: '‚õÖ Delvis molnigt',
              3: '‚òÅÔ∏è Molnigt',
              45: 'üå´Ô∏è Dimma',
              48: 'üå´Ô∏è Dimma',
              51: 'üå¶Ô∏è L√§tt duggregn',
              61: 'üåßÔ∏è Regn',
              71: 'üå®Ô∏è Sn√∂',
              95: '‚õàÔ∏è √Öska'
            };
            const desc = iconMap[weatherCode] || 'üå°Ô∏è V√§der';
            document.getElementById('weather').textContent = `${desc} ${temp}¬∞C`;
          })
          .catch(() => {
            document.getElementById('weather').textContent = 'Kunde inte h√§mta v√§der.';
          });
      })
      .catch(() => {
        document.getElementById('ip').textContent = 'Kunde inte h√§mta data.';
      });
  </script>
</body>
</html>
